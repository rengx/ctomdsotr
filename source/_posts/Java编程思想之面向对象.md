---
title: Java编程思想之面向对象
date: 2017-06-07 00:46:50
tags: java编程思想
categories: 语言

---

# 一切都是对象

## 用引用操纵对象
在java中，一切被视为对象，操作对象的标识符实际上是对象的一个“引用”（reference）。
书中以遥控器比引用，电视机比对象，我们直接操作的是遥控器（引用），再由遥控器来调控电视机（对象），而且我们可以在房间中走动的同时调控电视机，只需携带遥控器而不是电视机。此外，即使没有电视机，遥控器也可以独立存在。
这个例子可以说明，我们可以使用引用，在不同的地方操作对象；我们也可以拥有一个引用，这个引用也不一定必须有一个对象与之关联，但是这仅限于在我们使用这个引用之前。

## 必须由你创建所有对象
在使用引用之前，必须关联一个对象。

### 对象存储在哪
程序运行时，对象是怎么进行放置安排的呢？

1. 寄存器。因为它位于CPU内部，所以存取最快，当然数量也极其有限（书中用了“极其有限”）。我们不能直接控制，也感觉不到它的存在。
2. 堆栈。位于RAM（随机访问存储器），是存放数据的一种内存区域（[stack的三种含义](http://www.ruanyifeng.com/blog/2013/11/stack.html "stack的三种含义")）。堆栈是有结构的，数据结构就是栈，每个区块大小固定，适宜存大小固定的数据，比如如对象的引用，基本数据类型。
3. 堆。位于RAM，没有结构，大小也不固定，可以任意存放。用于存放所有的对象。
4. 常量。直接存放在程序代码中（反编译class文件即可看到）。
5. 非RAM存储，比如数据库等。

### 特例：基本类型
前面我们知道所有对象都要使用new 创建，并且存在堆中。但是，一些比较小的、简单的变量，这样做不是很有效。这些变量，不用new来创建，是非引用类型的变量。这些变量直接存储值（引用类型变量存储的是对象的地址），位于堆栈中，因此更高效。
这些变量存放于堆栈，因此大小就要是固定的，在java中，也不像其他语言随机器硬件架构的变化而变化。这也是java具有可移植性的原因之一。
基本类型有boolean/byte/char/short/int/long/float/double/void。

## 永远不需要销毁对象
1. 作用域
2. 对象的作用域
基本类型，在作用域终点时就会从堆栈中移除；对象类型的变量，对象的引用在作用域终点会消失，但是对象依然会在堆中占据内存空间，直到被垃圾回收机制处理。

## 创建新的数据类型：类
我们可以的的用户class（关键字）+空格+类型名，创建一个新的数据类型。
一旦定义了一个类，就可以在类中设置两种类型的元素:字段（数据成员）和方法（成员方法）。字段可以是任意类型的对象，可以是基本类型，也可以是引用类型（某个对象的引用）。

### 成员
基本成员（基本类型成员）具有默认值，即便初始化（基本类型仅在作为成员变量时，java才会给定默认值）。但是，引用类型的成员为NULL，所以引用类型在创建后要先关联一个对象后才能被使用。

### 方法、参数和返回值
Java的方法决定了一个对象能够接收什么样的消息。方法的基本组成：名称、参数、返回值和方法体。方法名和参数（合称方法签名）唯一地标识一个方法。
方法只有通过对象才能被调用。
参数列表，指定要传递给方法什么样的信息，这些信息同Java的其他信息一样也是对象。像Java中任何传递对象的场合一样，这里传递的实际也是引用（基本类型是例外）。

### static关键字
static域和方法，不与包含它的那个类的任何对象关联在一起。非static域和方法必须与特定的对象关联。
在使用static域和方法时，可以使用类来调用（也是推荐的方式），也可以使用其所属类的对象。
static域只有一份存储空间，不过创建了多少个其所属类的对象。


# 初始化与清理

> 随着计算机革命的发展，“不安全”的编程方式已逐渐成为编程代价高昂的主因之一。
初始化和清理正是涉及安全的两个问题。
许多C程序的错误都源于程序员忘记初始化变量。特别是在使用程序库时，如果用户不知道如何初始化库的构件（或者用户必须初始化的其他东西），更是如此。清理是一个特殊的问题，当使用完一个元素时，它对你也就不会有什么影响了，所以很容易把它忘记。这样一来，这个元素占用的资源就会一直得不到释放，结果是资源（特别是内存）用尽。

引用了书中的原话，很清晰。为什么要初始化，以及java中约定用构造器初始化的意义，即使用程序库的时候，知道如何初始化并且也不会忘记。“清理”说的也很清楚。

## 用构造器确保初始化
构造器采用与类相同的名称。在创建对象时：
```
new ClassName();
```
将会为对象分配存储空间，并调用相应的构造器。构造器是一种特殊的方法，没有返回值（这与返回值为空（void）不同）。
不接受任何参数的构造器叫做默认构造器，Java术语为无参构造器。

## 方法重载
重载，用于表示相同但有细微差别的概念。将方法重载用于构造器，可以提供创建对象的多种方式，非构造器方法也可以使用。
区分重载方法：每个重载的方法都必须有一个独一无二的参数类型列表。而且，参数顺序也可以区分（不过，一般情况别这么做，会使代码难以维护）。但是，返回值是不能用于区分重载的。
基本类型的重载，基本类型能从一个“较小”的类型自动提升至一个“较大”的类型。char略有不同，如果找不恰好接收char参数的方法，会提升为int。基本类型很有必要从[这里学习](http://www.runoob.com/java/java-basic-datatypes.html)。

## 默认构造器
如果，你的类的中没有写构造器，则编译器就会自动帮你创建一个默认构造器；但是，如果你定义了一个构造器（无论是否有参数），编译器就不会帮你自动创建默认构造器了。

## this关键字
this关键字只能在方法内部使用，表示对“调用方法的那个对象”的引用。
不过，在方法内部调用同一个类的另一个方法，就不必使用this了，因为编译器自动帮你添加。只有当需要明确指出对当对象的引用时，才需要使用this，如：
```
public class Lear{
  int i;
  Leaf increament(){
     i++;
     return this;
  }
}
```
this关键字对于将当前对象传递给其他方法也很有用。
```
public class ThisDemo {
    public static void main(String[] args) {
        Person person = new Person();
        person.eat(new Apple());
    }
}

class Person {
    public void eat(Apple apple) {
        Apple peeled = apple.getPeeled();
        System.out.println("Yummy");
    }
}

class Apple {
    Apple getPeeled() {
        return Peeler.peel(this);
    }
}

class Peeler {
    static Apple peel(Apple apple) {
        // remove peel
        return apple;
    }
}  /*output:
Yummy
*///:~
```
this还用与在构造器中调用构造器。

### static的含义
static方法，就是没有this的方法。

## 清理：终结处理和垃圾回收

A a = new A(1);
a = new A(2); // new A(1)产生的对象将被丢弃，并等待回收（如果没有别的引用关联它）。

## 成员初始化
Java尽力保证：所有变量在使用前都能得到恰当的初始化。
对于方法的局部变量，Java以编译时错误的形式来贯彻这种保证。
对于类的数据成员（即字段），如果是基本类型，在创建对象时会有一个初始值（数字类型为0，布尔为false，char为0且打印为空白）；如果是引用类型，就会获得一个特殊值null。

## 构造器初始化
可以使用构造器来进行初始化。但是，这无法阻止自动初始化的进行，成员初始化在构造初始化之前进行。
### 初始化顺序
在类内部，变量定义的先后顺序决定了初始化的顺序。
即使，变量定义方法定义之间，他们仍旧会在任何方法（包括构造器）被调用之前得到初始化。
### 静态数据的初始化

### 显式静态初始化
### 非静态实例初始化

域/局部变量

## 数组初始化

### 可变参数列表

## 枚举类型